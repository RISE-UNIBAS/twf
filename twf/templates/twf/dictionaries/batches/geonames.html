{% extends 'twf/base/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
     <div class="border rounded bg-light mt-0 p-3">
        <h1 class="display-6">Search Geonames</h1>
         <p class="lead">Geonames is a geo-database and used for locations.</p>
         {% include 'twf/dictionaries/batches/notice.html' %}
         
         {% crispy form %}
     
     </div>
{% endblock %}

{% block script %}
    <script src="{% static 'twf/js/celery_task_monitor.js' %}"></script>
    <script>
        $(document).ready(function() {
            $('#button-id-startbatch').click(function() {
                const startUrl = '/celery/dictionaries/batch/geonames/'; // Task start URL
                const progressUrlBase = '/celery/status/'; // Base URL for polling progress
                const progressBarId = '#taskProgressBar'; // ID of the progress bar element
                const logTextareaId = '#id_progress_details'; // ID of the textarea to display logs
                
                // Start the task
                startTask(startUrl, progressUrlBase, progressBarId, logTextareaId);
            });
        });
    </script>
    <script>
        $(document).ready(function() {
            $('#button-id-startbatch').click(function() {
                const dictionaryId = $('#id_dictionary').val();
                const geonamesSearchType = $('#geonames_search_type').val();
                
                $.ajax({
                    url: '/start_geonames_batch/',  // The URL for your task trigger
                    method: 'GET',  // Use 'POST' if your form submits via POST
                    data: {
                        dictionary_id: dictionaryId,
                        geonames_search_type: geonamesSearchType,
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            alert('Task started successfully! Task ID: ' + response.task_id);
                        } else {
                            alert('Failed to start task.');
                        }
                    },
                    error: function() {
                        alert('Error starting task.');
                    }
                });
            });
        });
    </script>
{% endblock %}